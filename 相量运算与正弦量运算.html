<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相量运算与正弦量关系演示</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #1565c0;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .mode-selector {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 12px 25px;
            margin: 0 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #90caf9;
            color: #0d47a1;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .mode-btn:hover {
            background: #64b5f6;
            transform: translateY(-2px);
        }
        
        .mode-btn.active {
            background: #2196f3;
            color: white;
            box-shadow: 0 4px 12px rgba(33,150,243,0.4);
        }
        
        .main-content {
            display: flex;
            gap: 25px;
            margin-top: 20px;
        }
        
        .canvas-container {
            flex: 1;
            text-align: center;
        }
        
        canvas {
            border: 1px solid #90caf9;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            width: 320px;
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
        }
        
        .control-section {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: none;
        }
        
        .control-section.active {
            display: block;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1976d2;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
            height: 6px;
            border-radius: 3px;
            background: #bbdefb;
        }
        
        .value-display {
            text-align: center;
            font-weight: bold;
            color: #d32f2f;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #2196f3;
            color: white;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background: #1976d2;
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .legend {
            margin-top: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .legend h4 {
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        .legend-item {
            margin-bottom: 8px;
        }
        
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 3px;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .formula-box {
            margin-top: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>相量运算与正弦量关系演示</h1>
        
        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('addition')">相量加法</button>
            <button class="mode-btn" onclick="setMode('integration')">正弦量积分</button>
        </div>
        
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas" width="800" height="600"></canvas>
            </div>
            
            <div class="controls">
                <div id="addition-controls" class="control-section active">
                    <h3 style="color: #1565c0; margin-bottom: 15px;">相量1参数</h3>
                    <div class="control-group">
                        <label for="amp1">幅值1:</label>
                        <input type="range" id="amp1" min="20" max="80" value="50">
                        <div class="value-display" id="amp1Value">50</div>
                    </div>
                    <div class="control-group">
                        <label for="phase1">相位1 (度):</label>
                        <input type="range" id="phase1" min="-180" max="180" value="0">
                        <div class="value-display" id="phase1Value">0°</div>
                    </div>
                    
                    <h3 style="color: #1565c0; margin-bottom: 15px;">相量2参数</h3>
                    <div class="control-group">
                        <label for="amp2">幅值2:</label>
                        <input type="range" id="amp2" min="20" max="80" value="40">
                        <div class="value-display" id="amp2Value">40</div>
                    </div>
                    <div class="control-group">
                        <label for="phase2">相位2 (度):</label>
                        <input type="range" id="phase2" min="-180" max="180" value="90">
                        <div class="value-display" id="phase2Value">90°</div>
                    </div>
                    
                    <div class="control-group">
                        <label for="frequency">公共频率 (Hz):</label>
                        <input type="range" id="frequency" min="0.3" max="1.5" step="0.1" value="0.8">
                        <div class="value-display" id="frequencyValue">0.8</div>
                    </div>
                </div>
                
                <div id="integration-controls" class="control-section">
                    <h3 style="color: #1565c0; margin-bottom: 15;">原始相量参数</h3>
                    <div class="control-group">
                        <label for="ampInt">幅值:</label>
                        <input type="range" id="ampInt" min="30" max="100" value="60">
                        <div class="value-display" id="ampIntValue">60</div>
                    </div>
                    <div class="control-group">
                        <label for="phaseInt">初相位 (度):</label>
                        <input type="range" id="phaseInt" min="-180" max="180" value="0">
                        <div class="value-display" id="phaseIntValue">0°</div>
                    </div>
                    <div class="control-group">
                        <label for="freqInt">频率 (Hz):</label>
                        <input type="range" id="freqInt" min="0.3" max="1.5" step="0.1" value="0.8">
                        <div class="value-display" id="freqIntValue">0.8</div>
                    </div>
                    
                    <div class="formula-box">
                        <strong>积分关系：</strong><br>
                        ∫sin(ωt+φ)dt = -1/ω cos(ωt+φ)<br>
                        = 1/ω sin(ωt+φ-90°)
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="startBtn">开始</button>
                    <button id="pauseBtn">暂停</button>
                    <button id="resetBtn">重置</button>
                </div>
                
                <div class="legend">
                    <h4>图例说明</h4>
                    <div id="addition-legend" class="legend-section active">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #2196f3;"></span>
                            相量1 & 正弦波1 (实线)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #4caf50;"></span>
                            相量2 & 正弦波2 (实线)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff9800;"></span>
                            合成相量 & 合成波 (粗线)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #9e9e9e;"></span>
                            相量-波形连接线
                        </div>
                    </div>
                    
                    <div id="integration-legend" class="legend-section">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #2196f3;"></span>
                            原始相量 & 原始波形 (实线)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff9800;"></span>
                            积分相量 & 积分波形 (虚线)
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #9e9e9e;"></span>
                            相量-波形连接线
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let isRunning = false;
        let animationId = null;
        let startTime = null;
        let pausedTime = 0;
        let currentMode = 'addition';
        
        let amp1 = 50, amp2 = 40;
        let phase1 = 0, phase2 = Math.PI/2;
        let frequency = 0.8;
        
        let ampInt = 60, phaseInt = 0, freqInt = 0.8;
        
        const centerX = 180;
        const centerY = 300;
        
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.control-section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.legend-section').forEach(section => section.classList.remove('active'));
            
            if (mode === 'addition') {
                document.querySelector('.mode-btn').classList.add('active');
                document.getElementById('addition-controls').classList.add('active');
                document.getElementById('addition-legend').classList.add('active');
            } else {
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
                document.getElementById('integration-controls').classList.add('active');
                document.getElementById('integration-legend').classList.add('active');
            }
            
            resetAnimation();
        }
        
        document.getElementById('amp1').oninput = function() {
            amp1 = parseInt(this.value);
            document.getElementById('amp1Value').textContent = amp1;
            if (!isRunning) draw();
        };
        
        document.getElementById('amp2').oninput = function() {
            amp2 = parseInt(this.value);
            document.getElementById('amp2Value').textContent = amp2;
            if (!isRunning) draw();
        };
        
        document.getElementById('phase1').oninput = function() {
            const degrees = parseInt(this.value);
            phase1 = degrees * Math.PI / 180;
            document.getElementById('phase1Value').textContent = degrees + '°';
            if (!isRunning) draw();
        };
        
        document.getElementById('phase2').oninput = function() {
            const degrees = parseInt(this.value);
            phase2 = degrees * Math.PI / 180;
            document.getElementById('phase2Value').textContent = degrees + '°';
            if (!isRunning) draw();
        };
        
        document.getElementById('frequency').oninput = function() {
            frequency = parseFloat(this.value);
            document.getElementById('frequencyValue').textContent = frequency.toFixed(1);
            if (!isRunning) draw();
        };
        
        document.getElementById('ampInt').oninput = function() {
            ampInt = parseInt(this.value);
            document.getElementById('ampIntValue').textContent = ampInt;
            if (!isRunning) draw();
        };
        
        document.getElementById('phaseInt').oninput = function() {
            const degrees = parseInt(this.value);
            phaseInt = degrees * Math.PI / 180;
            document.getElementById('phaseIntValue').textContent = degrees + '°';
            if (!isRunning) draw();
        };
        
        document.getElementById('freqInt').oninput = function() {
            freqInt = parseFloat(this.value);
            document.getElementById('freqIntValue').textContent = freqInt.toFixed(1);
            if (!isRunning) draw();
        };
        
        document.getElementById('startBtn').onclick = function() {
            if (!isRunning) {
                isRunning = true;
                startTime = performance.now() - pausedTime;
                animate();
            }
        };
        
        document.getElementById('pauseBtn').onclick = function() {
            if (isRunning) {
                isRunning = false;
                pausedTime = performance.now() - startTime;
                cancelAnimationFrame(animationId);
            }
        };
        
        document.getElementById('resetBtn').onclick = resetAnimation;
        
        function resetAnimation() {
            isRunning = false;
            pausedTime = 0;
            startTime = null;
            cancelAnimationFrame(animationId);
            draw();
        }
        
        function animate() {
            if (!isRunning) return;
            
            const currentTime = (performance.now() - startTime) / 1000;
            draw(currentTime);
            animationId = requestAnimationFrame(animate);
        }
        
        function draw(time = 0) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (currentMode === 'addition') {
                drawPhasorAddition(time);
            } else {
                drawIntegration(time);
            }
        }
        
        function drawPhasorAddition(t) {
            const angle = 2 * Math.PI * frequency * t;
            
            const staticSumX = amp1 * Math.cos(phase1) + amp2 * Math.cos(phase2);
            const staticSumY = amp1 * Math.sin(phase1) + amp2 * Math.sin(phase2);
            const staticSumAmp = Math.sqrt(staticSumX * staticSumX + staticSumY * staticSumY);
            const staticSumPhase = Math.atan2(staticSumY, staticSumX);
            
            // 左侧相量图
            drawAxes(centerX, centerY);
            drawCircle(centerX, centerY, Math.max(amp1, amp2, staticSumAmp));
            
            const endX1 = centerX + amp1 * Math.cos(angle + phase1);
            const endY1 = centerY - amp1 * Math.sin(angle + phase1);
            const endX2 = centerX + amp2 * Math.cos(angle + phase2);
            const endY2 = centerY - amp2 * Math.sin(angle + phase2);
            
            drawPhasor(centerX, centerY, endX1, endY1, '#2196f3', '相量1');
            drawPhasor(centerX, centerY, endX2, endY2, '#4caf50', '相量2');
            
            const sumEndX = centerX + staticSumAmp * Math.cos(angle + staticSumPhase);
            const sumEndY = centerY - staticSumAmp * Math.sin(angle + staticSumPhase);
            drawPhasor(centerX, centerY, sumEndX, sumEndY, '#ff9800', '合成', true);
            
            // 右侧波形 - 与左侧相量图中心对齐
            const waveStartX = 400;
            const waveWidth = 350;
            const waveCenterY = centerY;
            
            drawWaveAxes(waveStartX, waveCenterY, waveWidth);
            
            // 在同一坐标系上叠加绘制三个波形
            drawWave(waveStartX, waveCenterY, waveWidth, amp1, frequency, phase1, '#2196f3', t, 1);
            drawWave(waveStartX, waveCenterY, waveWidth, amp2, frequency, phase2, '#4caf50', t, 1);
            drawWave(waveStartX, waveCenterY, waveWidth, staticSumAmp, frequency, staticSumPhase, '#ff9800', t, 3);
            
            // 绘制连接线（相量末端 ↔ 正弦波最新点）
            const waveLatestY1 = waveCenterY - amp1 * Math.sin(2 * Math.PI * frequency * t + phase1);
            const waveLatestY2 = waveCenterY - amp2 * Math.sin(2 * Math.PI * frequency * t + phase2);
            const waveLatestYsum = waveCenterY - staticSumAmp * Math.sin(2 * Math.PI * frequency * t + staticSumPhase);
            
            drawConnection(endX1, endY1, waveStartX, waveLatestY1, '#2196f3');
            drawConnection(endX2, endY2, waveStartX, waveLatestY2, '#4caf50');
            drawConnection(sumEndX, sumEndY, waveStartX, waveLatestYsum, '#ff9800');
            
            // 显示参数（调整位置避免重叠）
            displayParameters(10, 50, [
                `相量1: 幅值=${amp1}, 相位=${(phase1*180/Math.PI).toFixed(0)}°`,
                `相量2: 幅值=${amp2}, 相位=${(phase2*180/Math.PI).toFixed(0)}°`,
                `合成: 幅值=${staticSumAmp.toFixed(1)}, 相位=${(staticSumPhase*180/Math.PI).toFixed(0)}°`,
                `频率: ${frequency.toFixed(1)} Hz`
            ]);
        }
        
        function drawIntegration(t) {
            const staticIntegratedAmp = ampInt / freqInt;
            const staticIntegratedPhase = phaseInt - Math.PI/2;
            const angle = 2 * Math.PI * freqInt * t;
            
            // 左侧相量图
            drawAxes(centerX, centerY);
            
            const endX = centerX + ampInt * Math.cos(angle + phaseInt);
            const endY = centerY - ampInt * Math.sin(angle + phaseInt);
            drawPhasor(centerX, centerY, endX, endY, '#2196f3', '原始相量');
            
            const intEndX = centerX + staticIntegratedAmp * Math.cos(angle + staticIntegratedPhase);
            const intEndY = centerY - staticIntegratedAmp * Math.sin(angle + staticIntegratedPhase);
            drawPhasor(centerX, centerY, intEndX, intEndY, '#ff9800', '积分相量');
            
            // 右侧波形 - 与左侧相量图中心对齐
            const waveStartX = 400;
            const waveWidth = 350;
            const waveCenterY = centerY;
            
            drawWaveAxes(waveStartX, waveCenterY, waveWidth);
            
            // 原始波形（实线）
            drawWave(waveStartX, waveCenterY, waveWidth, ampInt, freqInt, phaseInt, '#2196f3', t, 2);
            
            // 积分波形（虚线）
            ctx.setLineDash([6, 6]);
            drawWave(waveStartX, waveCenterY, waveWidth, staticIntegratedAmp, freqInt, staticIntegratedPhase, '#ff9800', t, 2);
            ctx.setLineDash([]);
            
            // 绘制连接线
            const waveLatestY = waveCenterY - ampInt * Math.sin(2 * Math.PI * freqInt * t + phaseInt);
            const waveLatestYint = waveCenterY - staticIntegratedAmp * Math.sin(2 * Math.PI * freqInt * t + staticIntegratedPhase);
            
            drawConnection(endX, endY, waveStartX, waveLatestY, '#2196f3');
            drawConnection(intEndX, intEndY, waveStartX, waveLatestYint, '#ff9800');
            
            // 显示参数（调整位置避免重叠）
            displayParameters(10, 50, [
                `原始: 幅值=${ampInt}, 相位=${(phaseInt*180/Math.PI).toFixed(0)}°`,
                `积分后: 幅值=${staticIntegratedAmp.toFixed(1)}, 相位=${((phaseInt-Math.PI/2)*180/Math.PI).toFixed(0)}°`,
                `频率: ${freqInt.toFixed(1)} Hz`
            ]);
        }
        
        function drawAxes(cx, cy) {
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(cx - 100, cy);
            ctx.lineTo(cx + 100, cy);
            ctx.moveTo(cx, cy - 100);
            ctx.lineTo(cx, cy + 100);
            ctx.stroke();
        }
        
        function drawCircle(cx, cy, radius) {
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        function drawPhasor(startX, startY, endX, endY, color, label, isBold = false) {
            ctx.strokeStyle = color;
            ctx.lineWidth = isBold ? 4 : 2;
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            
            const angle = Math.atan2(startY - endY, endX - startX);
            const arrowLength = 10;
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - arrowLength * Math.cos(angle - Math.PI/6), 
                      endY + arrowLength * Math.sin(angle - Math.PI/6));
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - arrowLength * Math.cos(angle + Math.PI/6), 
                      endY + arrowLength * Math.sin(angle + Math.PI/6));
            ctx.stroke();
            
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(endX, endY, isBold ? 6 : 4, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        function drawWaveAxes(startX, centerY, width) {
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(startX, centerY);
            ctx.lineTo(startX + width, centerY);
            ctx.stroke();
            
            // 绘制网格线
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(startX, centerY - 80);
            ctx.lineTo(startX + width, centerY - 80);
            ctx.moveTo(startX, centerY + 80);
            ctx.lineTo(startX + width, centerY + 80);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        function drawWave(startX, baseY, width, amplitude, freq, phase, color, time, lineWidth) {
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            
            for (let i = 0; i <= width; i += 2) {
                const space = (i / width) * 4 * Math.PI;
                const totalPhase = 2 * Math.PI * freq * time + phase + space;
                const x = startX + i;
                const y = baseY - amplitude * Math.sin(totalPhase);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
        }
        
        // 新增：绘制相量与波形的连接线
        function drawConnection(startX, startY, endX, endY, color) {
            ctx.strokeStyle = '#9e9e9e';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // 在连接点绘制小圆点
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(endX, endY, 4, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        function displayParameters(x, y, params) {
            ctx.fillStyle = '#0d47a1';
            ctx.font = 'bold 14px Arial';
            params.forEach((param, index) => {
                ctx.fillText(param, x, y + index * 20);
            });
        }
        
        draw();
    </script>
</body>
</html>