<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相量与正弦量关系演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .canvas-container {
            flex: 1;
            text-align: center;
        }
        
        canvas {
            border: 1px solid #ccc;
            background: white;
        }
        
        .controls {
            width: 300px;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .value-display {
            text-align: center;
            font-weight: bold;
            color: #007bff;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .legend {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .legend-item {
            margin-bottom: 5px;
        }
        
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 3px;
            margin-right: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>相量与正弦量关系演示</h1>
        
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="canvas" width="600" height="400"></canvas>
            </div>
            
            <div class="controls">
                <h3>参数控制</h3>
                
                <div class="control-group">
                    <label for="amplitude">幅值:</label>
                    <input type="range" id="amplitude" min="30" max="100" value="60">
                    <div class="value-display" id="amplitudeValue">60</div>
                </div>
                
                <div class="control-group">
                    <label for="frequency">频率 (Hz):</label>
                    <input type="range" id="frequency" min="0.2" max="2" step="0.1" value="0.8">
                    <div class="value-display" id="frequencyValue">0.8</div>
                </div>
                
                <div class="control-group">
                    <label for="phase">初相位 (度):</label>
                    <input type="range" id="phase" min="-180" max="180" value="0">
                    <div class="value-display" id="phaseValue">0°</div>
                </div>
                
                <div class="button-group">
                    <button id="startBtn">开始</button>
                    <button id="pauseBtn">暂停</button>
                    <button id="resetBtn">重置</button>
                </div>
                
                <div class="legend">
                    <h4>图例:</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background: blue;"></span>
                        相量
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: red;"></span>
                        正弦波
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: green;"></span>
                        投影线
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取画布和上下文
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // 获取控件
        const ampSlider = document.getElementById('amplitude');
        const freqSlider = document.getElementById('frequency');
        const phaseSlider = document.getElementById('phase');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // 获取显示元素
        const ampValue = document.getElementById('amplitudeValue');
        const freqValue = document.getElementById('frequencyValue');
        const phaseValue = document.getElementById('phaseValue');
        
        // 参数
        let amplitude = 60;
        let frequency = 0.8;
        let phase = 0; // 弧度
        
        // 动画状态
        let isRunning = false;
        let animationId = null;
        let startTime = null;
        let pausedTime = 0;
        
        // 画布中心
        const centerX = 150;
        const centerY = 200;
        
        // 滑动条事件 - 使用oninput确保实时响应
        ampSlider.oninput = function() {
            amplitude = parseInt(this.value);
            ampValue.textContent = amplitude;
            if (!isRunning) draw();
        };
        
        freqSlider.oninput = function() {
            frequency = parseFloat(this.value);
            freqValue.textContent = frequency.toFixed(1);
            if (!isRunning) draw();
        };
        
        phaseSlider.oninput = function() {
            const degrees = parseInt(this.value);
            phase = degrees * Math.PI / 180;
            phaseValue.textContent = degrees + '°';
            if (!isRunning) draw();
        };
        
        // 按钮事件
        startBtn.onclick = function() {
            if (!isRunning) {
                isRunning = true;
                startTime = performance.now() - pausedTime;
                animate();
            }
        };
        
        pauseBtn.onclick = function() {
            if (isRunning) {
                isRunning = false;
                pausedTime = performance.now() - startTime;
                cancelAnimationFrame(animationId);
            }
        };
        
        resetBtn.onclick = function() {
            isRunning = false;
            pausedTime = 0;
            startTime = null;
            cancelAnimationFrame(animationId);
            draw();
        };
        
        // 动画函数
        function animate() {
            if (!isRunning) return;
            
            const currentTime = (performance.now() - startTime) / 1000;
            draw(currentTime);
            animationId = requestAnimationFrame(animate);
        }
        
        // 绘制函数
        function draw(currentTime = 0) {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 计算当前角度
            const angle = 2 * Math.PI * frequency * currentTime + phase;
            
            // 绘制坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, centerY);
            ctx.lineTo(250, centerY);
            ctx.moveTo(centerX, 50);
            ctx.lineTo(centerX, 350);
            ctx.stroke();
            
            // 绘制参考圆
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, amplitude, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // 绘制相量
            const endX = centerX + amplitude * Math.cos(angle);
            const endY = centerY - amplitude * Math.sin(angle);
            
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            
            // 绘制端点
            ctx.fillStyle = 'blue';
            ctx.beginPath();
            ctx.arc(endX, endY, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            // 绘制投影线
            ctx.strokeStyle = 'green';
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX, centerY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // 绘制正弦波
            const waveStartX = 300;
            const waveWidth = 250;
            const waveHeight = 100;
            
            // 波形坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(waveStartX, centerY);
            ctx.lineTo(waveStartX + waveWidth, centerY);
            ctx.stroke();
            
            // 绘制波形
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i <= waveWidth; i += 2) {
                const t = (i / waveWidth) * 4 * Math.PI;
                const x = waveStartX + i;
                const y = centerY - amplitude * Math.sin(frequency * t + angle);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 显示参数
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText(`幅值: ${amplitude}`, 10, 30);
            ctx.fillText(`频率: ${frequency.toFixed(1)} Hz`, 10, 50);
            ctx.fillText(`相位: ${(phase * 180 / Math.PI).toFixed(0)}°`, 10, 70);
        }
        
        // 初始绘制
        draw();
    </script>
</body>
</html>